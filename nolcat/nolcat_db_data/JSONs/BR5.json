[
    {
        "op": "core/column-rename",
        "oldColumnName": "Column",
        "newColumnName": "Resource_Name",
        "description": "Rename column ``Column`` to ``Resource_Name``"
    },
    {
        "op": "core/column-rename",
        "oldColumnName": "Title",
        "newColumnName": "Resource_Name",
        "description": "Rename column ``Title`` to ``Resource_Name``"
    },
    {
        "op": "core/column-rename",
        "oldColumnName": "Book DOI",
        "newColumnName": "DOI",
        "description": "Rename column ``Book DOI`` to ``DOI``"
    },
    {
        "op": "core/column-rename",
        "oldColumnName": "Proprietary Identifier",
        "newColumnName": "Proprietary_ID",
        "description": "Rename column ``Proprietary Identifier`` to ``Proprietary_ID``"
    },
    {
        "op": "core/column-rename",
        "oldColumnName": "ISSN",
        "newColumnName": "Online_ISSN",
        "description": "Rename column ``ISSN`` to ``Online_ISSN``"
    },
    {
        "op": "core/column-rename",
        "oldColumnName": "User activity",
        "newColumnName": "Metric_Type",
        "description": "Rename column ``User activity`` to ``Metric_Type``"
    },
    {
        "op": "core/column-rename",
        "oldColumnName": "User Activity",
        "newColumnName": "Metric_Type",
        "description": "Rename column ``User Activity`` to ``Metric_Type``"
    },
    {
        "op": "core/row-removal",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Resource_Name",
                    "expression": "grel:or(value.toLowercase().startsWith(\"total searches\"),value.toLowercase().startsWith(\"total for all titles\"))",
                    "columnName": "Resource_Name",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "description": "Remove total rows"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Resource_Name",
        "expression": "grel:value.replace(/\\n/,\"\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Remove errant newlines from ``Resource_Name`` values"
    },
    {
        "op": "core/transpose-columns-into-rows",
        "startColumnName": "Reporting Period Total",
        "columnCount": -1,
        "ignoreBlankCells": false,
        "fillDown": true,
        "separator": null,
        "keyColumnName": "Usage_Date",
        "valueColumnName": "Usage_Count",
        "description": "Pivot all columns with counts into two columns, one named ``Usage_Date`` with the column name/date and the other named ``Usage_Count`` with the data value/count"
    },
    {
        "op": "core/row-removal",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Usage_Date",
                    "expression": "grel:value.find(/[Rr]eporting\\s[Pp]eriod/).length()>0",
                    "columnName": "Usage_Date",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "description": "Remove rows with total values"
    },
    {
        "op": "core/row-removal",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Usage_Count",
                    "expression": "grel:or(isBlank(value),value==0)",
                    "columnName": "Usage_Count",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "description": "Remove rows with no usage"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Usage_Date",
        "expression": "grel:if(isError(value.replace(/E[D|S]T/,\"\").toDate()),if(isNotNull(value.match(/(\\w{3})\\-(\\d{4})/)),value.replace(\"-\",\"-01-\").toDate(),if(value.match(/(\\w*)\\-\\d{4}/)[0].length()>3,(value.match(/(\\w{3}).*/)[0]+\"-01\"+value.match(/\\w*(\\-\\d{4})/)[0]).toDate(),\"ERROR [\"+value+\"]\")),value.replace(/E[D|S]T/,\"\").toDate())",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change the values in column ``Usage_Date`` to date data type with null time value"
    },
    {
        "op": "core/column-addition",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "baseColumnName": "Metric_Type",
        "expression": "grel:\"Book\"",
        "onError": "set-to-blank",
        "newColumnName": "Data_Type",
        "columnInsertIndex": 8,
        "description": "Create column ``Data_Type`` containing value `Book`"
    },
    {
        "op": "core/column-addition",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "baseColumnName": "Metric_Type",
        "expression": "grel:\"Book\"",
        "onError": "set-to-blank",
        "newColumnName": "Section_Type",
        "columnInsertIndex": 9,
        "description": "Create column ``Section_Type`` containing value `Book`"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Resource_Name",
        "expression": "grel:if(or(isBlank(value),isNonBlank(value.match(/\\s*/))),\"NULL\",value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change null and whitespace values to `NULL` in column ``Resource_Name``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Publisher",
        "expression": "grel:if(or(isBlank(value),isNonBlank(value.match(/\\s*/))),\"NULL\",value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change null and whitespace values to `NULL` in column ``Publisher``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "DOI",
        "expression": "grel:if(or(isBlank(value),isNonBlank(value.match(/\\s*/))),\"NULL\",value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change null and whitespace values to `NULL` in column ``DOI``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Proprietary_ID",
        "expression": "grel:if(or(isBlank(value),isNonBlank(value.match(/\\s*/))),\"NULL\",value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change null and whitespace values to `NULL` in column ``Proprietary_ID``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "ISBN",
        "expression": "grel:if(or(isBlank(value),isNonBlank(value.match(/\\s*/))),\"NULL\",value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change null and whitespace values to `NULL` in column ``ISBN``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Online_ISSN",
        "expression": "grel:if(or(isBlank(value),isNonBlank(value.match(/\\s*/))),\"NULL\",value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change null and whitespace values to `NULL` in column ``Online_ISSN``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Resource_Name",
        "expression": "grel:value.reinterpret(\"utf-8\").unescape(\"html\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Ensure values in column ``Resource_Name`` are encoded with UTF-8"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Publisher",
        "expression": "grel:value.reinterpret(\"utf-8\").unescape(\"html\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Ensure values in column ``Publisher`` are encoded with UTF-8"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Platform",
        "expression": "grel:value.reinterpret(\"utf-8\").unescape(\"html\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Ensure values in column ``Platform`` are encoded with UTF-8"
    }
]