digraph erd_and_classes {
    graph [rankdir = "LR"]
    /*
        ellipse = field/attribute
        note = PK
        folder = FK
        component = FK that makes up a composite PK
        Mrecord = methods

        Starting with two underscores means not from user stories
    */

    /* *** ESTABLISHED RELATIONS/CLASSES *** */

    subgraph cluster_fiscalYears {
        label="fiscalYears"

        // Attributes
        fiscal_year_ID [shape="note"]
        year
        _start_date // The FY start as date data type to go in SQL queries
        _end_date // The FY end as date data type to go in SQL queries
        // The submitted values are stored because vendors sometimes report issues with their stats collection, which require reharvesting
        ACRL_60b // Initial Circulation: Digital/Electronic
        ACRL_63 // E-Serials Usage: Digital/Electronic
        ARL_18 // Number of successful full-text article requests (journals)
        ARL_19 // Number of regular searches (databases)
        ARL_20 // Number of federated searches (databases)
        // Should the date when the numbers were collected be saved?
        notes_on_statisticsSources_used
        notes_on_corrections_after_submission // If a vendor issues a correction requiring reharvesting after numbers are submitted, should it be recorded here or on the page of the specific source being reharvested?

        // Methods
        // Should each number have its own method, or should all of them be calculated at the same time?
        calculate_ACRL_60b [shape="Mrecord"]
        calculate_ACRL_63 [shape="Mrecord"]
        calculate_ARL_18 [shape="Mrecord"]
        calculate_ARL_19 [shape="Mrecord"]
        calculate_ARL_20 [shape="Mrecord"]
        __create_usage_tracking_records_for_fiscal_year [shape="Mrecord"]
        collect_fiscal_year_usage_statistics [shape="Mrecord"]
    }


    subgraph cluster_vendors {
        label="vendors"

        //Attributes
        vendor_ID [shape="note"]
        vendor_name
        alma_vendor_code

        //Methods
        get_SUSHI_credentials_from_Alma [shape="Mrecord"]
        get_SUSHI_credentials_from_JSON [shape="Mrecord"]
        add_note [shape="Mrecord"]
    }

    
    subgraph cluster_vendorNotes {
        label="vendorNotes"

        //Attributes
        vendor_notes_ID [shape="note"]
        note_in_vendorNotes [label="note"]
        written_by_in_vendorNotes [label="written_by"]
        date_written_in_vendorNotes [label="date_written"]
        vendor_ID_in_vendorNotes [
            label="vendor_ID"
            shape="folder"
        ]

        //Methods
    }


    subgraph cluster_statisticsSources {
        label="statisticsSources"

        // Attributes
        statistics_source_ID [shape="note"]
        statistics_source_name
        statistics_source_retrieval_code
        vendor_ID_in_statisticsSources [
            label="vendor_ID"
            shape="folder"
        ]
        

        // Methods
        fetch_SUSHI_information [shape="Mrecord"]
        _harvest_R5_SUSHI [shape="Mrecord"]
        collect_usage_statistics [shape="Mrecord"]
        add_note [shape="Mrecord"]
    }


    subgraph cluster_statisticsSourceNotes {
        label="statisticsSourceNotes"

        //Attributes
        statistics_source_notes_ID [shape="note"]
        note_in_statisticsSourceNotes [label="note"]
        written_by_in_statisticsSourceNotes [label="written_by"]
        date_written_in_statisticsSourceNotes [label="date_written"]
        statistics_source_ID_in_statisticsSourceNotes [
            label="statistics_source_ID"
            shape="folder"
        ]

        //Methods
    }


    subgraph cluster_statisticsResourceSources {
        label="statisticsResourceSources"

        // Attributes
        SRS_statistics_source [shape="component"]
        SRS_resource_source [shape="component"]
        current_statistics_source // This indicates if the given statistics source is the active source for the resourceSource's usage. Every resourceSource in use must have a current statisticsSource regardless of if usage is actually provided for the resourceSource because the current statisticsSource is how the intentional omission of resourceSources that don't provide usage is tracked.

        // Methods
    }


    subgraph cluster_resourceSources {
        label="resourceSources"

        // Attributes
        resource_source_ID [shape="note"]
        resource_source_name
        source_in_use
        use_stop_date
        vendor_ID_in_resourceSources [
            label="vendor_ID"
            shape="folder"
        ]

        // Methods
        add_access_stop_date [shape="Mrecord"]
        remove_access_stop_date [shape="Mrecord"]
        add_note [shape="Mrecord"]
    }


    subgraph cluster_resourceSourceNotes {
        label="resourceSourceNotes"

        //Attributes
        resource_source_notes_ID [shape="note"]
        note_in_resourceSourceNotes [label="note"]
        written_by_in_resourceSourceNotes [label="written_by"]
        date_written_in_resourceSourceNotes [label="date_written"]
        resource_source_ID_in_resourceSourceNotes [
            label="resource_source_ID"
            shape="folder"
        ]

        //Methods
    }


    subgraph cluster_annualUsageCollectionTracking {
        label="annualUsageCollectionTracking"

        // Attributes
        AUCT_statistics_source [shape="component"]
        AUCT_fiscal_year [shape="component"]
        usage_is_being_collected
        __manual_collection_required
        __collection_via_email
        __is_COUNTER_compliant
        __collection_status
        __usage_file_path
        notes

        // Methods
        collect_annual_usage_statistics [shape="Mrecord"]
        upload_nonstandard_usage_file [shape="Mrecord"]
    }


    subgraph cluster_resources {
        label="resources"

        // Attributes
        resource_ID [shape="note"]
        data_type // The initial list from R4 reports will have the less specific R4 types derived from the type of report itself. Should the R5 types overwrite these values or go in their own field?
        __section_type // This is in R5 IR only-how to add it? Does it go here?
        note

        // Methods
    }


    subgraph cluster_resourceMetadata {
        label="resourceMetadata"

        // Attributes
        resource_metadata_ID [shape="note"]
        metadata_field
        metadata_value [
            shape="record"
            label="\N|title (R4)|title (TR)|database (DR)|item (IR)|DOI|ISBN|print ISSN|online ISSN"
        ]
        default
        resource_ID_in_resourceMetadata [
            label="resource_ID"
            shape="folder"
        ]

        // Methods
    }


    subgraph cluster_resourcePlatforms {
        label="resourcePlatforms"

        // Attributes
        resource_platform_ID [shape="note"]
        publisher // From the COUNTER report
        publisher_ID // This is found in R5 only—how to add it?
        platform [
            shape="record"
            label="\N|user interfaces"
        ]
        proprietary_ID
        __URI // This is found in R5 TR, IR only—how to add it?
        // Parent_Data_Type?
        // Parent_DOI?
        // Parent_Proprietary_ID?
        interface [shape="folder"] // This is interface in the Alma sense--the FK for Statistics_Source
        resource_ID_in_resourcePlatforms [
            label="resource_ID"
            shape="folder"
        ]

        // Methods
    }


    subgraph cluster_usageData {
        label="usageData"

        // Nouns: Classes or Attributes
        usage_data_ID [shape="note"]
        resource_platform_ID_in_usageData [
            label="resource_platform_ID"
            shape="folder"
        ]
        __metric_type
        __usage_date
        usage_count [
            shape="record"
            label="\N|usage stats|e-resources usage numbers"
        ]
        __YOP // This is found in R5 TR, IR only—how to add it?
        __access_type // This is found in R5 TR, IR only—how to add it?
        __access_method // This is found in R5 only—how to add it?
        __report_creation_date // For harvested R5 reports

        // Methods
    }


    subgraph cluster_RawCOUNTERReport {
        label="CLASS: RawCOUNTERReport"

        // Attributes
        report_dataframe

        // Methods
        perform_deduplication_matching [shape="Mrecord"]
        load_data_into_database [shape="Mrecord"]
    }


    subgraph cluster_SUSHICallAndResponse {
        label="CLASS: SUSHICallAndResponse"

        // Attributes
        Chrome_user_agent
        calling_to
        call_URL
        call_path
        parameters

        // Methods
        make_SUSHI_call [shape="Mrecord"]
        _retrieve_downloaded_JSON [shape="Mrecord"]
        _handle_SUSHI_exceptions [shape="Mrecord"]
        _create_error_query_text [shape="Mrecord"]
    }


    subgraph cluster_Blueprints {
        label="CLASS: Blueprints"

        annual_stats [
            shape="record"
            label="\N"
        ]
        ingest_usage [
            shape="record"
            label="\N|COUNTER reports|R4 reports|R5 SUSHI"
        ]
        initialization [
            shape="record"
            label="\N|COUNTER reports|historical usage data"
        ]
        login [
            shape="record"
            label="\N|librarians (as users)"
        ]
        view_resources [
            shape="record"
            label="\N"
        ]
        view_sources [
            shape="record"
            label="\N"
        ]
        view_usage [
            shape="record"
            label="\N|COUNTER stats"
        ]
        view_vendors [
            shape="record"
            label="\N"
        ]
    }


    // RELATIONSHIPS (ordered by PK, then FK)
    /*
        Establish relationships from the PK (tail) to the FK (head)
        table --------(can connect to)---------[optionality]--(and)--[cardinality]-->other table
        arrowhead = how PK table can connect to FK table
        arrowtail = how FK table can connect to PK table

        teeodot = 0..1 (unique but optional)
        crowodot = 0..N (optional, not unique)
        teetee = 1..1 (exactly one)
        crowtee = 1..N (neither optional nor unique)
    */

    fiscal_year_ID -> AUCT_fiscal_year [
        dir="both"
        arrowhead="crowodot"
        arrowtail="teetee"
    ]


    vendor_ID -> vendor_ID_in_vendorNotes [
        dir="both"
        arrowhead="crowodot"
        arrowtail="teetee"
    ]


    vendor_ID -> vendor_ID_in_statisticsSources [
        dir="both"
        arrowhead="crowodot" // Want the option to have a vendor without a statistics source
        arrowtail="teetee"
    ]


    vendor_ID -> vendor_ID_in_resourceSources [
        dir="both"
        arrowhead="crowodot" // Want the option to have a vendor without a statistics source
        arrowtail="teetee"
    ]


    statistics_source_ID -> statistics_source_ID_in_statisticsSourceNotes [
        dir="both"
        arrowhead="crowodot"
        arrowtail="teetee"
    ]


    statistics_source_ID -> SRS_statistics_source [
        dir="both"
        arrowhead="crowtee"
        arrowtail="teetee"
    ]


    statistics_source_ID -> AUCT_statistics_source [
        dir="both"
        arrowhead="crowodot" // Since sources don't need to be connected to a collection year, they can be added as they arise, rather than needing to wait for the first round of collections in which they'll be included
        arrowtail="teetee"
    ]


    statistics_source_ID -> interface [
        dir="both"
        arrowhead="crowodot"
        arrowtail="teetee"
    ]


    resource_source_ID -> SRS_resource_source [
        dir="both"
        arrowhead="crowtee"
        arrowtail="teetee"
    ]


    resource_source_ID -> resource_source_ID_in_resourceSourceNotes [
        dir="both"
        arrowhead="crowodot"
        arrowtail="teetee"
    ]


    resource_ID -> resource_ID_in_resourceMetadata [
        dir="both"
        arrowhead="crowtee"
        arrowtail="teetee"
    ]


    resource_ID -> resource_ID_in_resourcePlatforms [
        dir="both"
        arrowhead="crowodot" // Platforms are normalized in this relation; they don't connect to individual resources
        arrowtail="teetee"
    ]


    resource_platform_ID -> resource_platform_ID_in_usageData [
        dir="both"
        arrowhead="crowtee"
        arrowtail="teetee"
    ]


    /* *** OBJECTS TO BE ORGANIZED *** */

    // Nouns: Classes or Attributes
    "Databases A to Z"
    "Databases A to Z items"
    "names a databases goes and has gone by"
    /* Do these need to be kept?
        reference
        location
        databases
        aggregator
        initial database data
        unique resource list
    */

    //Verbs: Methods
    store
    match
    connect
    change

    subgraph cluster_Technical_Terms {
        // Nouns: Classes or Attributes
        spreadsheets
        emails
        files
        "file format"
        workbooks
        database
        "normalized list of resources"
        // Verbs: Methods
        download
        "generate emails"
        upload
        dedupe
        copy
        paste
    }

    subgraph cluster_Acquisitions_Terms {
        // Nouns: Classes or Attributes
        "order numbers"
        "current ILS"
        "legacy ILS"
        "price data"
        invoices
        // Verbs: Methods
    }
}