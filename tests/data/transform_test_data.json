[
    {
        "op": "core/column-removal",
        "columnName": "Column 81",
        "description": "Remove empty column ``Column 81``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Statistics_Source_ID",
        "expression": "value.toNumber()",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Make cells in column ``Statistics_Source_ID`` numbers"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "YOP",
        "expression": "value.toNumber()",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Make cells in column ``YOP`` numbers"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Publication_Date",
        "expression": "grel:value.split(\"T\")[0].toDate()",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change the values in column ``Publication_Date`` to date data type"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Publication_Date",
        "expression": "grel:if(or(value.toString('yyyy-MM-DD')=='1000-01-01',value.toString('yyyy-MM-DD')=='1753-01-01',value.toString('yyyy-MM-DD')=='1900-01-01'),null,value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Null values in column ``Publication_Date`` if the dates are the RDBMS/spreadsheet minimum date data type values `1000-01-01`, `1753-01-01`, or `1900-01-01`"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Parent_Publication_Date",
        "expression": "grel:value.split(\"T\")[0].toDate()",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change the values in column ``Parent_Publication_Date`` to date data type"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Parent_Publication_Date",
        "expression": "grel:if(or(value.toString('yyyy-MM-DD')=='1000-01-01',value.toString('yyyy-MM-DD')=='1753-01-01',value.toString('yyyy-MM-DD')=='1900-01-01'),null,value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Null values in column ``Parent_Publication_Date`` if the dates are the RDBMS/spreadsheet minimum date data type values `1000-01-01`, `1753-01-01`, or `1900-01-01`"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "DOI",
        "expression": "grel:if(or(value==\"\",value==\" \"),null,value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change whitespace values to null in column ``DOI``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Proprietary Identifier",
        "expression": "grel:if(or(value==\"\",value==\" \"),null,value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change whitespace values to null in column ``Proprietary Identifier``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Online_ISSN",
        "expression": "grel:if(or(value==\"\",value==\" \"),null,value)",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change whitespace values to null in column ``Online_ISSN``"
    },
    {
        "op": "core/column-rename",
        "oldColumnName": "Proprietary Identifier",
        "newColumnName": "Proprietary_ID",
        "description": "Rename column ``Proprietary Identifier`` to ``Proprietary_ID``"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Metric_Type",
        "expression": "grel:value.replace(\"licence\",\"license\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Have `license` always use American English spelling"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Metric_Type",
        "expression": "grel:value.replace(\"denied.\", \"denied:\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Have turnaway report metrics always use a colon"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Resource_Name",
        "expression": "grel:value.replace(/\\n/,\"\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Remove errant newlines from ``Resource_Name`` values"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Report_Type",
                    "expression": "value",
                    "columnName": "Report_Type",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "BR1",
                                "l": "BR1"
                            }
                        },
                        {
                            "v": {
                                "v": "BR2",
                                "l": "BR2"
                            }
                        },
                        {
                            "v": {
                                "v": "BR3",
                                "l": "BR3"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "columnName": "Data_Type",
        "expression": "grel:\"Book\"",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change values in column ``Data_Type`` to `Book` for BR1, BR2, and BR3 reports"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Report_Type",
                    "expression": "value",
                    "columnName": "Report_Type",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "DB1",
                                "l": "DB1"
                            }
                        },
                        {
                            "v": {
                                "v": "DB2",
                                "l": "DB2"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "columnName": "Data_Type",
        "expression": "grel:\"Database\"",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change values in column ``Data_Type`` to `Database` for DB1 and DB2 reports"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Report_Type",
                    "expression": "value",
                    "columnName": "Report_Type",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "JR1",
                                "l": "JR1"
                            }
                        },
                        {
                            "v": {
                                "v": "JR2",
                                "l": "JR2"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "columnName": "Data_Type",
        "expression": "grel:\"Journal\"",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change values in column ``Data_Type`` to `Journal` for JR1 and JR2 reports"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Report_Type",
                    "expression": "value",
                    "columnName": "Report_Type",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "MR1",
                                "l": "MR1"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "columnName": "Data_Type",
        "expression": "grel:\"Multimedia\"",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change values in column ``Data_Type`` to `Multimedia` for MR1 reports"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Report_Type",
                    "expression": "value",
                    "columnName": "Report_Type",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "PR1",
                                "l": "PR1"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "columnName": "Data_Type",
        "expression": "grel:\"Platform\"",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change values in column ``Data_Type`` to `Platform` for PR1 reports"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Report_Type",
                    "expression": "value",
                    "columnName": "Report_Type",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "BR1",
                                "l": "BR1"
                            }
                        },
                        {
                            "v": {
                                "v": "BR3",
                                "l": "BR3"
                            }
                        },
                        {
                            "v": {
                                "v": "BR5",
                                "l": "BR5"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "columnName": "Section_Type",
        "expression": "grel:\"Book\"",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change values in column ``Section_Type`` to `Book` for BR1, BR3, and BR5 reports"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Report_Type",
                    "expression": "value",
                    "columnName": "Report_Type",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "BR2",
                                "l": "BR2"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "columnName": "Section_Type",
        "expression": "grel:\"Book_Segment\"",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change values in column ``Section_Type`` to `Book_Segment` for BR2 reports"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Report_Type",
                    "expression": "value",
                    "columnName": "Report_Type",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "JR1",
                                "l": "JR1"
                            }
                        },
                        {
                            "v": {
                                "v": "JR2",
                                "l": "JR2"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "columnName": "Section_Type",
        "expression": "grel:\"Article\"",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change values in column ``Section_Type`` to `Article` for JR1 and JR2 reports"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Report_Type",
                    "expression": "value",
                    "columnName": "Report_Type",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "TR1",
                                "l": "TR1"
                            }
                        },
                        {
                            "v": {
                                "v": "BR1",
                                "l": "BR1"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "columnName": "Metric_Type",
        "expression": "grel:\"Successful Title Requests\"",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change values in column ``Metric_Type`` to `Successful Title Requests` for BR1 and TR1 reports"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Report_Type",
                    "expression": "value",
                    "columnName": "Report_Type",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "MR1",
                                "l": "MR1"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "columnName": "Metric_Type",
        "expression": "grel:\"Successful Content Unit Requests\"",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change values in column ``Metric_Type`` to `Successful Content Unit Requests` for MR1 reports"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Report_Type",
                    "expression": "value",
                    "columnName": "Report_Type",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "JR1",
                                "l": "JR1"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "columnName": "Metric_Type",
        "expression": "grel:\"Successful Full-text Article Requests\"",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change values in column ``Metric_Type`` to `Successful Full-text Article Requests` for JR1 reports"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Report_Type",
                    "expression": "value",
                    "columnName": "Report_Type",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": "BR2",
                                "l": "BR2"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "columnName": "Metric_Type",
        "expression": "grel:\"Successful Section Requests\"",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change values in column ``Metric_Type`` to `Successful Section Requests` for BR2 reports"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Resource_Name",
        "expression": "grel:value.reinterpret(\"utf-8\").unescape(\"html\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Ensure values in column ``Resource_Name`` are encoded with UTF-8"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Publisher",
        "expression": "grel:value.reinterpret(\"utf-8\").unescape(\"html\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Ensure values in column ``Publisher`` are encoded with UTF-8"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Platform",
        "expression": "grel:value.reinterpret(\"utf-8\").unescape(\"html\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Ensure values in column ``Platform`` are encoded with UTF-8"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Authors",
        "expression": "grel:value.reinterpret(\"utf-8\").unescape(\"html\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Ensure values in column ``Authors`` are encoded with UTF-8"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Parent_Title",
        "expression": "grel:value.reinterpret(\"utf-8\").unescape(\"html\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Ensure values in column ``Parent_Title`` are encoded with UTF-8"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Parent_Authors",
        "expression": "grel:value.reinterpret(\"utf-8\").unescape(\"html\")",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Ensure values in column ``Parent_Authors`` are encoded with UTF-8"
    },
    {
        "op": "core/transpose-columns-into-rows",
        "startColumnName": "2016-07-01T00:00-04:00",
        "columnCount": -1,
        "ignoreBlankCells": true,
        "fillDown": true,
        "separator": null,
        "keyColumnName": "Usage_Date",
        "valueColumnName": "Usage_Count",
        "description": "Pivot all columns with counts into two columns, one named ``Usage_Date`` with the column name/date and the other named ``Usage_Count`` with the data value/count"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Usage_Count",
        "expression": "value.toNumber()",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Make cells in column ``Usage_Count`` numbers"
    },
    {
        "op": "core/row-removal",
        "engineConfig": {
            "facets": [
                {
                    "type": "list",
                    "name": "Usage_Count",
                    "expression": "grel:or(isBlank(value),value==0)",
                    "columnName": "Usage_Count",
                    "invert": false,
                    "omitBlank": false,
                    "omitError": false,
                    "selection": [
                        {
                            "v": {
                                "v": true,
                                "l": "true"
                            }
                        }
                    ],
                    "selectBlank": false,
                    "selectError": false
                }
            ],
            "mode": "row-based"
        },
        "description": "Remove rows with no usage"
    },
    {
        "op": "core/text-transform",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "columnName": "Usage_Date",
        "expression": "grel:value.split(\"T\")[0].toDate()",
        "onError": "keep-original",
        "repeat": false,
        "repeatCount": 10,
        "description": "Change the values in column ``Usage_Date`` to date data type"
    },
    {
        "op": "core/column-reorder",
        "columnNames": [
            "df",
            "Statistics_Source_ID",
            "Report_Type",
            "Resource_Name",
            "Publisher",
            "Publisher_ID",
            "Platform",
            "Authors",
            "Publication_Date",
            "Article_Version",
            "DOI",
            "Proprietary_ID",
            "ISBN",
            "Print_ISSN",
            "Online_ISSN",
            "URI",
            "Data_Type",
            "Section_Type",
            "YOP",
            "Access_Type",
            "Access_Method",
            "Parent_Title",
            "Parent_Authors",
            "Parent_Publication_Date",
            "Parent_Article_Version",
            "Parent_Data_Type",
            "Parent_DOI",
            "Parent_Proprietary_ID",
            "Parent_ISBN",
            "Parent_Print_ISSN",
            "Parent_Online_ISSN",
            "Parent_URI",
            "Metric_Type",
            "Usage_Date",
            "Usage_Count"
        ],
        "description": "Reorder columns"
    },
    {
        "op": "core/column-addition",
        "engineConfig": {
            "facets": [],
            "mode": "row-based"
        },
        "baseColumnName": "Statistics_Source_ID",
        "expression": "grel:'['+forEach(row.columnNames,field,if(isBlank(cells[field].value),'None',if(cells[field].value.type()=='date','\"'+cells[field].value.toString('yyyy-MM-dd')+'\"',if(cells[field].value.type()=='string','\"'+cells[field].value.replace('\"','\\\\\"')+'\"',cells[field].value.round())))).join(', ')+', None]'",
        "onError": "set-to-blank",
        "newColumnName": "df",
        "columnInsertIndex": 0,
        "description": "Create column ``df`` by combining all the other fields, adding a null field for `report_creation_date`, and formatting them for insertion into a dataframe"
    }
]